{"ast":null,"code":"import _regeneratorRuntime from\"/home/ray-bang8/trovo-fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/ray-bang8/trovo-fe/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/ray-bang8/trovo-fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/ray-bang8/trovo-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from\"react\";import PaymentTypes from\"../PaymentTypes\";import s from\"./index.module.scss\";import{BROKER_LINKS,CURRENCY_TYPE}from\"../../utils/constants\";import{updatePaymentType}from\"../../utils/formatters\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var PaymentForm=function PaymentForm(_ref){var selectedCard=_ref.selectedCard,className=_ref.className;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),usernameError=_useState4[0],setUsernameError=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),currency=_useState6[0],setCurrency=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),currencyError=_useState8[0],setCurrencyError=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),promoCode=_useState10[0],setPromoCode=_useState10[1];var validateUsername=function validateUsername(){var name_field=username.trim();if(name_field.length<=0){setUsernameError(true);return true;}setUsernameError(false);return false;};var validateCurrency=function validateCurrency(){if(currency===\"\"){setCurrencyError(true);return true;}setCurrencyError(false);return false;};var isFieldsHasErrors=function isFieldsHasErrors(){var isNameError=validateUsername();var isCurrencyError=validateCurrency();return isNameError||isCurrencyError;};var startTransaction=function startTransaction(){var brokerType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var isInvalidFields,amount,payload,payloadAsQueryParams,urlLink,response,redirectLink;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:isInvalidFields=isFieldsHasErrors();if(!isInvalidFields){_context.next=3;break;}return _context.abrupt(\"return\");case 3:amount=selectedCard.value;payload={currency:currency,username:username,promoCode:promoCode,\"payment-type\":updatePaymentType(brokerType,amount),platform:\"TROVO\"};payloadAsQueryParams=new URLSearchParams(_objectSpread({},payload));urlLink=\"\".concat(BROKER_LINKS[brokerType]).concat(payloadAsQueryParams.toString());_context.prev=7;_context.next=10;return fetch(urlLink);case 10:response=_context.sent;_context.next=13;return response.text();case 13:redirectLink=_context.sent;window.location=redirectLink;_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](7);console.log(_context.t0,123);case 20:case\"end\":return _context.stop();}},_callee,null,[[7,17]]);}));};return/*#__PURE__*/_jsxs(\"form\",{className:\"\".concat(className,\" \").concat(s[\"payment-form\"]),children:[/*#__PURE__*/_jsx(\"h2\",{className:s[\"form-title\"],children:\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0417\\u0430\\u043A\\u0430\\u0437\\u0430\"}),/*#__PURE__*/_jsx(\"hr\",{className:s[\"separator-line\"]}),/*#__PURE__*/_jsx(\"span\",{className:s[\"info-text\"],children:\"\\u041F\\u0440\\u0438 \\u043F\\u043E\\u043A\\u0443\\u043F\\u043A\\u0435, \\u0443\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u0412\\u0430\\u0448\\u0435 \\\"\\u0418\\u043C\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F\\\" \\u0438 \\u044D\\u043B\\u0438\\u043A\\u0441\\u0438\\u0440\\u044B \\u0441\\u0440\\u0430\\u0437\\u0443 \\u043D\\u0430\\u0447\\u0438\\u0441\\u043B\\u044F\\u0442\\u044C\\u0441\\u044F \\u043D\\u0430 \\u0412\\u0430\\u0448 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442!\"}),/*#__PURE__*/_jsxs(\"span\",{className:s[\"info-text\"],children:[\"\\u0412\\u044B \\u043F\\u0440\\u0438\\u043E\\u0431\\u0440\\u0435\\u0442\\u0430\\u0435\\u0442\\u0435: \",selectedCard.title]}),/*#__PURE__*/_jsxs(\"main\",{className:s[\"form-fields\"],children:[/*#__PURE__*/_jsx(\"input\",{className:\"\".concat(s[\"form-fields__input\"],\" \").concat(usernameError&&s[\"form-fields__input--error\"]),placeholder:\"\\u0418\\u043C\\u044F \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F \\u0422\\u0440\\u043E\\u0432\\u043E\",value:username,onChange:function onChange(e){return setUsername(e.target.value);},onBlur:validateUsername,required:true}),/*#__PURE__*/_jsxs(\"select\",{className:\"\".concat(s[\"form-fields__select\"],\" \").concat(currencyError&&s[\"form-fields__select--error\"]),value:currency,onChange:function onChange(e){return setCurrency(e.target.value);},onBlur:validateCurrency,required:true,children:[/*#__PURE__*/_jsx(\"option\",{selected:true,value:\"\",disabled:true,children:\"\\u0412\\u0430\\u043B\\u044E\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"option\",{value:CURRENCY_TYPE.RUB,children:\"RUB\"}),/*#__PURE__*/_jsx(\"option\",{value:CURRENCY_TYPE.USD,children:\"USD\"}),/*#__PURE__*/_jsx(\"option\",{value:CURRENCY_TYPE.EUR,children:\"EUR\"})]}),/*#__PURE__*/_jsx(\"input\",{className:s[\"form-fields__input\"],placeholder:\"\\u041F\\u0440\\u043E\\u043C\\u043E\\u043A\\u043E\\u0434\",value:promoCode,onChange:function onChange(e){return setPromoCode(e.target.value);},required:true})]}),/*#__PURE__*/_jsx(PaymentTypes,{startTransaction:startTransaction})]});};","map":{"version":3,"names":["useEffect","useState","PaymentTypes","s","BROKER_LINKS","CURRENCY_TYPE","updatePaymentType","jsx","_jsx","jsxs","_jsxs","PaymentForm","_ref","selectedCard","className","_useState","_useState2","_slicedToArray","username","setUsername","_useState3","_useState4","usernameError","setUsernameError","_useState5","_useState6","currency","setCurrency","_useState7","_useState8","currencyError","setCurrencyError","_useState9","_useState10","promoCode","setPromoCode","validateUsername","name_field","trim","length","validateCurrency","isFieldsHasErrors","isNameError","isCurrencyError","startTransaction","brokerType","arguments","undefined","_asyncToGenerator","_regeneratorRuntime","mark","_callee","isInvalidFields","amount","payload","payloadAsQueryParams","urlLink","response","redirectLink","wrap","_callee$","_context","prev","next","abrupt","value","platform","URLSearchParams","_objectSpread","concat","toString","fetch","sent","text","window","location","t0","console","log","stop","children","title","placeholder","onChange","e","target","onBlur","required","selected","disabled","RUB","USD","EUR"],"sources":["/home/ray-bang8/trovo-fe/src/components/PaymentForm/index.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport PaymentTypes from \"../PaymentTypes\";\nimport s from \"./index.module.scss\";\nimport { BROKER_LINKS, CURRENCY_TYPE } from \"../../utils/constants\";\nimport { updatePaymentType } from \"../../utils/formatters\";\n\nexport const PaymentForm = ({ selectedCard, className }) => {\n  const [username, setUsername] = useState(\"\");\n  const [usernameError, setUsernameError] = useState(false);\n\n  const [currency, setCurrency] = useState(\"\");\n  const [currencyError, setCurrencyError] = useState(false);\n\n  const [promoCode, setPromoCode] = useState(\"\");\n\n  const validateUsername = () => {\n    let name_field = username.trim();\n\n    if (name_field.length <= 0) {\n      setUsernameError(true);\n      return true;\n    }\n    setUsernameError(false);\n    return false;\n  };\n\n  const validateCurrency = () => {\n    if (currency === \"\") {\n      setCurrencyError(true);\n      return true;\n    }\n\n    setCurrencyError(false);\n    return false;\n  };\n\n  const isFieldsHasErrors = () => {\n    let isNameError = validateUsername();\n    let isCurrencyError = validateCurrency();\n\n    return isNameError || isCurrencyError;\n  };\n\n  const startTransaction = (brokerType = \"\") => {\n    return async () => {\n      const isInvalidFields = isFieldsHasErrors();\n\n      if (isInvalidFields) return;\n\n      const { value: amount } = selectedCard;\n\n      const payload = {\n        currency,\n        username,\n        promoCode,\n        \"payment-type\": updatePaymentType(brokerType, amount),\n        platform: \"TROVO\",\n      };\n\n      const payloadAsQueryParams = new URLSearchParams({ ...payload });\n\n      const urlLink = `${\n        BROKER_LINKS[brokerType]\n      }${payloadAsQueryParams.toString()}`;\n\n      try {\n        const response = await fetch(urlLink);\n\n        const redirectLink = await response.text();\n\n        window.location = redirectLink;\n      } catch (error) {\n        console.log(error, 123);\n      }\n    };\n  };\n\n  return (\n    <form className={`${className} ${s[\"payment-form\"]}`}>\n      <h2 className={s[\"form-title\"]}>Оформление Заказа</h2>\n      <hr className={s[\"separator-line\"]} />\n      <span className={s[\"info-text\"]}>\n        При покупке, укажите Ваше \"Имя пользователя\" и эликсиры сразу\n        начисляться на Ваш аккаунт!\n      </span>\n      <span className={s[\"info-text\"]}>\n        Вы приобретаете: {selectedCard.title}\n      </span>\n      <main className={s[\"form-fields\"]}>\n        <input\n          className={`${s[\"form-fields__input\"]} ${\n            usernameError && s[\"form-fields__input--error\"]\n          }`}\n          placeholder=\"Имя пользователя Трово\"\n          value={username}\n          onChange={(e) => setUsername(e.target.value)}\n          onBlur={validateUsername}\n          required\n        />\n\n        <select\n          className={`${s[\"form-fields__select\"]} ${\n            currencyError && s[\"form-fields__select--error\"]\n          }`}\n          value={currency}\n          onChange={(e) => setCurrency(e.target.value)}\n          onBlur={validateCurrency}\n          required\n        >\n          <option selected value={\"\"} disabled>\n            Валюта\n          </option>\n          <option value={CURRENCY_TYPE.RUB}>RUB</option>\n          <option value={CURRENCY_TYPE.USD}>USD</option>\n          <option value={CURRENCY_TYPE.EUR}>EUR</option>\n        </select>\n\n        <input\n          className={s[\"form-fields__input\"]}\n          placeholder=\"Промокод\"\n          value={promoCode}\n          onChange={(e) => setPromoCode(e.target.value)}\n          required\n        />\n      </main>\n      <PaymentTypes startTransaction={startTransaction}></PaymentTypes>\n    </form>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}